<!DOCTYPE html>
<html lang="pt" xml:lang="pt" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title>CDC</title>
    <meta charset="utf8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet"
        href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css" />
    <script src="js-webshim/minified/polyfiller.js"></script>
    <style type="text/css">
        .box {
            background-color: antiquewhite;
            box-shadow: 8px 8px 6px grey;
            width: 450px;
            border-style: solid;
            border-width: 3px;
            border-color: lightblue;
            padding-left: 10px;
            padding-right: 10px;
            padding-bottom: 10px;
            margin-left: 2px;
        }

        body {
            background-color: #f0f0f2;
            margin: 0;
            padding: 2em;
            font-family: -apple-system, system-ui, BlinkMacSystemFont,
                "Segoe UI", "Open Sans", "Helvetica Neue", Helvetica, Arial,
                sans-serif;
        }

        input {
            margin: 10px 3px 10px 3px;
            border: 1px solid grey;
            border-radius: 5px;
            font-size: 12px;
            padding: 5px 5px 5px 5px;
        }

        label {
            position: relative;
            top: 12px;
            width: 190px;
            float: left;
        }

        #submitButton {
            width: 80px;
            margin-left: 20px;
        }

        #errorMessage {
            color: red;
            font-size: 90% !important;
        }

        #successMessage {
            color: green;
            font-size: 90% !important;
            display: block;
            margin-top: 20px;
        }

        .button {
            font-size: 13px;
            color: red;
            background-color: #f8fad7;
        }

        .button:hover {
            background-color: #fadad7;
        }

        #draggable {
            cursor: n-resize;
        }

        #cdcfieldset {
            cursor: move;
        }

        input.currency {
            text-align: left;
            padding-right: 15px;
        }

        .input-group .form-control {
            float: none;
        }

        .input-group .input-buttons {
            position: relative;
            z-index: 3;
        }

        .messages {
            text-align: center;
        }

        /* CSS para a tabela de resultados */
        table {
            border-collapse: collapse;
            width: 100%;
            text-align: center;
        }

        table th,
        table td {
            padding: 8px;
        }

        table th {
            background-color: #f8fad7;
            color: red;
        }

        table tr:nth-child(even) {
            background-color: #fadad7;
        }

        /* Alinhar valores à direita nas colunas de valores monetários (Prestação, Juros, Amortização, Saldo Devedor) */
        table td:nth-child(2),
        table td:nth-child(3),
        table td:nth-child(4),
        table td:nth-child(5) {
            text-align: right;
        }

        /* CSS para alinhar corretamente as colunas de valores monetários na tabela */
        .money {
            text-align: right;
        }
    </style>
</head>

<body>
    <fieldset id="cdcfieldset" class="draggable ui-widget-content" style="
                border: 1px black solid;
                background-color: #cac3ba;
                width: 400px;
            ">
        <legend style="
                    border: 5px lightblue solid;
                    margin-left: 1em;
                    background-color: #ff6347;
                    padding: 0.2em 0.8em;
                ">
            <strong>Crédito Direto ao Consumidor</strong>
        </legend>
        <form action="/cgi-bin/cdc.cgi" method="post">
            <div class="box">
                <span class="input-group-addon" style="color: antiquewhite">$</span>
                <label for="parc">Parcelamento:</label>
                <input id="parc" type="number" name="np" size="5" value="36" min="1" max="72000" step="1"
                    required />meses<br />

                <span class="input-group-addon" style="color: antiquewhite">$</span>
                <label for="itax">Taxa de juros:</label>
                <input id="itax" type="number" name="tax" size="10" value="0.50" min="0.0" max="100.0" step="any"
                    required />% mês<br />

                <span class="input-group-addon">$</span>
                <label for="ipv">Valor Financiado: </label>
                <input id="ipv" type="number" name="pv" value="1000" min="0.0" step="0.01" class="form-control currency"
                    required /><br />

                <span class="input-group-addon">$</span>
                <label for="ipp">Valor Final (opcional):</label>
                <input id="ipp" type="number" name="pp" value="0.0" min="0.0" step="0.01" class="form-control currency"
                    required /><br />

                <span class="input-group-addon">$</span>
                <label for="ipb">Valor a Voltar(opcional):</label>
                <input id="ipb" type="number" name="pb" value="0.0" min="0.0" step="0.01" class="form-control currency"
                    required /><br />

                <label for="idp">Entrada?</label>
                <input id="idp" type="checkbox" name="dp" value="1" /><br />
            </div>
            <div class="messages">
                <input id="submitButton" class="button" type="submit" value="Calcular" />
                    
            </div>
        </form>

        <div id="errorMessage" class="messages"></div>
        <div id="successMessage" class="messages">
            <p>
                Se não souber a taxa de juros coloque 0%, e forneça o valor
                final.
            </p>
        </div>
    </fieldset>


    <script type="text/javascript">
        $("#submitButton").click(function (event) {
            // Impedir o envio do formulário padrão
            event.preventDefault();

            // Obter os valores de entrada do usuário
            var np = parseInt($("#parc").val()); // Parcelamento (meses)
            var tax = parseFloat($("#itax").val()) / 100; // Taxa de juros (mensal)
            var pv = parseFloat($("#ipv").val()); // Valor financiado
            var pp = parseFloat($("#ipp").val()); // Valor final (opcional)
            var pb = parseFloat($("#ipb").val()); // Valor a voltar (opcional)
            var dp = $("#idp").is(":checked"); // Entrada (true ou false)



            // Validar os valores de entrada
            if (isNaN(np) || isNaN(tax) || isNaN(pv)) {
                $("#errorMessage").html("<p>Por favor, preencha os campos corretamente.</p>");
                $("#errorMessage").show();
                $("#successMessage").hide();
                return;
            }

            // Ajuste para a primeira parcela paga no ato da compra
            var n = np - (dp ? 1 : 0);

            // Calcular a parcela mensal (Tabela Price) com a entrada
            var i = tax; // Taxa de juros mensal
            var pmt; // Parcela mensal
            if (i === 0) {
                // Caso de juros zero
                pmt = pv / n;
            } else {
                pmt = (pv * i) / (1 - Math.pow(1 + i, -n));
            }

            // Calcular o valor final (se não fornecido)
            if (isNaN(pp)) {
                pp = pmt * n;
            }

            // Calcular o valor a voltar (se não fornecido)
            if (isNaN(pb)) {
                pb = pp - pv;
            }

            // Calcular o Custo Total do Empréstimo
            var cost = n * pmt - pv;

            // Calcular o Valor Total Pago
            var totalPaid = pv + cost;

            // Exibir os resultados
            $("#errorMessage").hide();
            $("#successMessage").html(
                "<p>Parcela Mensal: $" + pmt.toFixed(2) + "</p>" +
                "<p>Valor Final: $" + pp.toFixed(2) + "</p>" +
                "<p>Valor a Voltar: $" + pb.toFixed(2) + "</p>" +
                "<p>Custo Total do Empréstimo: $" + cost.toFixed(2) + "</p>" +
                "<p>Valor Total Pago: $" + totalPaid.toFixed(2) + "</p>"
            );
            $("#successMessage").show();

            // Preencher a tabela com os detalhes mensais
            var resultTable = $("#resultTable tbody");
            resultTable.empty(); // Limpar a tabela anterior, se houver

            var saldoDevedor = pv;

            for (var month = 1; month <= n; month++) {
                var juros = saldoDevedor * i;
                var amortizacao = pmt - juros;
                saldoDevedor -= amortizacao;

                // Adiciona a linha à tabela
                resultTable.append(
                    "<tr>" +
                    "<td>" + month + "</td>" +
                    "<td>$" + pmt.toFixed(2) + "</td>" +
                    "<td>$" + juros.toFixed(2) + "</td>" +
                    "<td>$" + amortizacao.toFixed(2) + "</td>" +
                    "<td>$" + saldoDevedor.toFixed(2) + "</td>" +
                    "</tr>"
                );
            }
        });

    </script>



    <script src="LCG.js"></script>

    <script type="text/javascript">
        $("#submitButton").click(function () {
            var errorMessage = "";
            if ($("#itax").val() == 0 && $("#ipp").val() == 0) {
                errorMessage +=
                    "<p>Taxa de juros e valor final não podem ser ambos nulos.</p>";
            }
            if ($("#itax").val() == 0 && $("#ipv").val() == 0) {
                errorMessage +=
                    "<p>Taxa de juros e valor financiado não podem ser ambos nulos.</p>";
            }
            if ($("#ipv").val() == 0 && $("#ipp").val() == 0) {
                errorMessage +=
                    "<p>Valor financiado e valor final não podem ser ambos nulos.</p>";
            }
            if (errorMessage != "") {
                $("#errorMessage").html(errorMessage);
                $("#errorMessage").show();
                $("#successMessage").hide();
                event.preventDefault();
            } else {
                $("#successMessage").show();
                $("#errorMessage").hide();
            }
        });
        dragAndSave("#cdcfieldset"); // $("#cdcfieldset").draggable()

        webshims.setOptions("forms-ext", {
            replaceUI: "auto",
            types: "number",
        });
        webshims.polyfill("forms forms-ext");
    </script>

    <!-- Botão exibe/oculta os resultados da tabela price -->
    <button id="toggleButton">Exibe/Oculta a tabela price</button>
    <div id="conteudo">
        <!-- tabela HTML -->
        <table id="resultTable" style="width:100%">
            <thead>
                <tr>
                    <th>Mês</th>
                    <th class="money">Prestação</th>
                    <th class="money">Juros</th>
                    <th class="money">Amortização</th>
                    <th class="money">Saldo Devedor</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        // Obtém o botão e o conteúdo
        const toggleButton = document.getElementById('toggleButton');
        const conteudo = document.getElementById('conteudo');

        // Define um estado inicial
        let conteudoVisivel = false;

        // Adiciona um ouvinte de evento ao botão
        toggleButton.addEventListener('click', function () {
            if (conteudoVisivel) {
                conteudo.style.display = 'none'; // Oculta o conteúdo
            } else {
                conteudo.style.display = 'block'; // Torna o conteúdo visível
            }

            // Inverte o estado
            conteudoVisivel = !conteudoVisivel;
        });
    </script>


</body>

</html>